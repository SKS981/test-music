<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时光留声 - 主应用</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 1.5em;
        }

        header .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        header .user-info button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        header .user-info button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #ddd;
        }

        .sidebar-header h2 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #444;
        }

        .add-contact-btn {
            width: 100%;
            padding: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .add-contact-btn:hover {
            background: #764ba2;
        }

        .contacts-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .contact-item {
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 10px;
        }

        .contact-item:hover {
            background: #f0f0f0;
        }

        .contact-item.active {
            background: #e6e6ff;
            border-left: 4px solid #667eea;
        }

        .contact-item h3 {
            margin-bottom: 5px;
            color: #444;
        }

        .contact-item p {
            font-size: 0.9em;
            color: #666;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            padding: 20px;
            background: white;
            border-bottom: 1px solid #ddd;
        }

        .content-header h2 {
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #444;
        }

        .content-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            gap: 20px;
        }

        .recording-section {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .recording-section h3 {
            margin-bottom: 20px;
            color: #444;
        }

        .preview-container {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        #preview {
            width: 100%;
            height: 300px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .recording-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .recording-controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        #start-record {
            background: #e74c3c;
            color: white;
        }

        #start-record:hover {
            background: #c0392b;
        }

        #stop-record {
            background: #3498db;
            color: white;
        }

        #stop-record:hover {
            background: #2980b9;
        }

        #toggle-camera {
            background: #95a5a6;
            color: white;
        }

        #toggle-camera:hover {
            background: #7f8c8d;
        }

        .relic-section {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .relic-section h3 {
            margin-bottom: 20px;
            color: #444;
        }

        .relic-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: 600;
            color: #555;
        }

        input, textarea, select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
        }

        .form-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        #ai-polish {
            background: #9b59b6;
            color: white;
        }

        #ai-polish:hover {
            background: #8e44ad;
        }

        #save-relic {
            background: #27ae60;
            color: white;
        }

        #save-relic:hover {
            background: #229954;
        }

        .relics-list {
            margin-top: 30px;
        }

        .relics-list h4 {
            margin-bottom: 15px;
            color: #444;
        }

        .relic-item {
            padding: 15px;
            border-radius: 5px;
            background: #f9f9f9;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .relic-item h5 {
            margin-bottom: 10px;
            color: #444;
        }

        .relic-item p {
            margin-bottom: 10px;
            color: #666;
            font-size: 0.9em;
        }

        .relic-actions {
            display: flex;
            gap: 10px;
        }

        .relic-actions button {
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background 0.3s;
        }

        .relic-actions button:hover {
            background: #764ba2;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #444;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #764ba2;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 300px;
                border-right: none;
                border-bottom: 1px solid #ddd;
            }

            .content-body {
                flex-direction: column;
            }

            header h1 {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>时光留声</h1>
        <div class="user-info">
            <span id="user-email">用户邮箱</span>
            <button id="logout-btn">退出登录</button>
        </div>
    </header>

    <div class="main-container">
        <!-- 左侧联系人列表 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>联系人</h2>
                <button class="add-contact-btn" id="add-contact-btn">添加联系人</button>
            </div>
            <div class="contacts-list" id="contacts-list">
                <!-- 联系人列表将通过JS动态生成 -->
            </div>
        </div>

        <!-- 右侧内容区 -->
        <div class="content-area">
            <div class="content-header">
                <h2>录制与遗物管理</h2>
            </div>
            <div class="content-body">
                <!-- 录制区域 -->
                <div class="recording-section">
                    <h3>音视频录制</h3>
                    <div class="preview-container">
                        <div id="preview">
                            <!-- 视频预览将通过JS动态生成 -->
                            <p>点击开始录制按钮调用摄像头/麦克风</p>
                        </div>
                    </div>
                    <div class="recording-controls">
                        <button id="start-record">开始录制</button>
                        <button id="stop-record" disabled>停止录制</button>
                        <button id="toggle-camera">切换摄像头</button>
                    </div>
                    <div class="message" id="recording-message"></div>
                </div>

                <!-- 遗物创建区域 -->
                <div class="relic-section">
                    <h3>创建遗物</h3>
                    <form class="relic-form" id="relic-form">
                        <div class="form-group">
                            <label for="relic-contact">选择联系人</label>
                            <select id="relic-contact" required>
                                <!-- 联系人选项将通过JS动态生成 -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="relic-title">标题</label>
                            <input type="text" id="relic-title" required>
                        </div>
                        <div class="form-group">
                            <label for="relic-content">内容</label>
                            <textarea id="relic-content" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="silence-threshold">沉默阈值（天）</label>
                            <input type="number" id="silence-threshold" min="1" max="365" value="7" required>
                        </div>
                        <div class="form-actions">
                            <button type="button" id="ai-polish">AI润色</button>
                            <button type="submit" id="save-relic">保存遗物</button>
                        </div>
                    </form>
                    <div class="relics-list" id="relics-list">
                        <h4>已创建的遗物</h4>
                        <!-- 遗物列表将通过JS动态生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加联系人模态框 -->
    <div class="modal" id="add-contact-modal">
        <div class="modal-content">
            <h3>添加联系人</h3>
            <form id="contact-form">
                <div class="form-group">
                    <label for="contact-name">姓名</label>
                    <input type="text" id="contact-name" required>
                </div>
                <div class="form-group">
                    <label for="contact-email">邮箱</label>
                    <input type="email" id="contact-email">
                </div>
                <div class="form-group">
                    <label for="contact-phone">电话</label>
                    <input type="tel" id="contact-phone">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-contact">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
            <div class="message" id="contact-message"></div>
        </div>
    </div>

    <script>
        // Supabase配置
        const supabaseUrl = 'https://gdvdbzxxgwbjeaynjimp.supabase.co';
        const supabaseAnonKey = 'sb_publishable_6fgteWV1lGxwi4Tgx_PuLQ_w1XiEmPF';

        // 初始化Supabase客户端
        const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

        // 全局变量
        let currentUser = null;
        let currentContact = null;
        let mediaStream = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let isCameraOn = true;

        // 检查用户登录状态
        async function checkUser() {
            console.log('开始检查用户登录状态...');
            try {
                const { data, error } = await supabase.auth.getUser();
                console.log('认证检查结果:', { data, error });
                
                if (error) {
                    console.error('认证检查失败:', error);
                    // 用户未登录，跳转到登录页面
                    window.location.href = 'index.html';
                } else if (!data.user) {
                    console.log('用户未登录，跳转到登录页面...');
                    // 用户未登录，跳转到登录页面
                    window.location.href = 'index.html';
                } else {
                    console.log('用户已登录:', data.user);
                    currentUser = data.user;
                    document.getElementById('user-email').textContent = data.user.email || '用户';
                    loadContacts();
                }
            } catch (err) {
                console.error('认证检查过程中发生错误:', err);
                // 发生错误，跳转到登录页面
                window.location.href = 'index.html';
            }
        }

        // 加载联系人
        async function loadContacts() {
            if (!currentUser) return;

            const { data: contacts, error } = await supabase
                .from('contacts')
                .select('*')
                .eq('user_id', currentUser.id);

            if (error) {
                console.error('加载联系人失败:', error);
                return;
            }

            const contactsList = document.getElementById('contacts-list');
            const relicContactSelect = document.getElementById('relic-contact');

            contactsList.innerHTML = '';
            relicContactSelect.innerHTML = '';

            // 添加默认选项
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '请选择联系人';
            relicContactSelect.appendChild(defaultOption);

            contacts.forEach(contact => {
                // 添加到联系人列表
                const contactItem = document.createElement('div');
                contactItem.className = 'contact-item';
                contactItem.dataset.id = contact.id;
                contactItem.innerHTML = `
                    <h3>${contact.name}</h3>
                    <p>${contact.email || '无邮箱'}</p>
                    <p>${contact.phone || '无电话'}</p>
                `;
                contactItem.addEventListener('click', () => {
                    selectContact(contact);
                });
                contactsList.appendChild(contactItem);

                // 添加到遗物表单的选择框
                const option = document.createElement('option');
                option.value = contact.id;
                option.textContent = contact.name;
                relicContactSelect.appendChild(option);
            });
        }

        // 选择联系人
        function selectContact(contact) {
            // 移除其他联系人的活动状态
            document.querySelectorAll('.contact-item').forEach(item => {
                item.classList.remove('active');
            });

            // 添加当前联系人的活动状态
            const contactItem = document.querySelector(`.contact-item[data-id="${contact.id}"]`);
            if (contactItem) {
                contactItem.classList.add('active');
            }

            currentContact = contact;
            loadRelics(contact.id);
        }

        // 加载遗物
        async function loadRelics(contactId) {
            if (!currentUser || !contactId) return;

            const { data: relics, error } = await supabase
                .from('relics')
                .select('*')
                .eq('user_id', currentUser.id)
                .eq('contact_id', contactId);

            if (error) {
                console.error('加载遗物失败:', error);
                return;
            }

            const relicsList = document.getElementById('relics-list');
            relicsList.innerHTML = '<h4>已创建的遗物</h4>';

            if (relics.length === 0) {
                relicsList.innerHTML += '<p>暂无遗物，点击上方按钮创建</p>';
                return;
            }

            relics.forEach(relic => {
                const relicItem = document.createElement('div');
                relicItem.className = 'relic-item';
                relicItem.innerHTML = `
                    <h5>${relic.title}</h5>
                    <p>${relic.content}</p>
                    ${relic.ai_enhanced_content ? `<p><strong>AI润色:</strong> ${relic.ai_enhanced_content}</p>` : ''}
                    <p><strong>沉默阈值:</strong> ${relic.silence_threshold_days}天</p>
                    <p><strong>创建时间:</strong> ${new Date(relic.created_at).toLocaleString()}</p>
                    <div class="relic-actions">
                        ${relic.audio_url ? `<button onclick="playAudio('${relic.audio_url}')">播放音频</button>` : ''}
                        ${relic.video_url ? `<button onclick="playVideo('${relic.video_url}')">播放视频</button>` : ''}
                    </div>
                `;
                relicsList.appendChild(relicItem);
            });
        }

        // 播放音频
        function playAudio(audioUrl) {
            const audio = new Audio(audioUrl);
            audio.play();
        }

        // 播放视频
        function playVideo(videoUrl) {
            const video = document.createElement('video');
            video.src = videoUrl;
            video.controls = true;
            video.autoplay = true;
            video.style.width = '100%';
            video.style.height = 'auto';
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.style.zIndex = '1001';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <button class="btn btn-secondary" style="position: absolute; top: 10px; right: 10px; z-index: 10;">关闭</button>
                    ${video.outerHTML}
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.btn-secondary').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }

        // 初始化音视频录制
        async function initRecording() {
            try {
                // 调用摄像头和麦克风
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    video: isCameraOn,
                    audio: true
                });

                // 创建视频预览
                const preview = document.getElementById('preview');
                preview.innerHTML = '';
                const video = document.createElement('video');
                video.srcObject = mediaStream;
                video.autoplay = true;
                video.muted = true; // 防止回声
                preview.appendChild(video);

                showMessage('recording-message', 'success', '摄像头/麦克风已成功调用');
            } catch (error) {
                console.error('调用摄像头/麦克风失败:', error);
                showMessage('recording-message', 'error', '调用摄像头/麦克风失败，请检查权限设置');
            }
        }

        // 开始录制
        function startRecording() {
            if (!mediaStream) {
                initRecording().then(() => {
                    startRecording();
                });
                return;
            }

            // 创建媒体录制器
            mediaRecorder = new MediaRecorder(mediaStream, {
                mimeType: isCameraOn ? 'video/webm' : 'audio/webm'
            });

            // 监听数据可用事件
            mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    recordedChunks.push(event.data);
                }
            };

            // 监听录制结束事件
            mediaRecorder.onstop = async () => {
                const blob = new Blob(recordedChunks, {
                    type: isCameraOn ? 'video/webm' : 'audio/webm'
                });

                // 上传到Supabase Storage
                await uploadToStorage(blob);

                // 重置录制状态
                recordedChunks = [];
            };

            // 开始录制
            mediaRecorder.start();
            document.getElementById('start-record').disabled = true;
            document.getElementById('stop-record').disabled = false;
            showMessage('recording-message', 'success', '开始录制...');
        }

        // 停止录制
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                document.getElementById('start-record').disabled = false;
                document.getElementById('stop-record').disabled = true;
                showMessage('recording-message', 'success', '录制已停止，正在上传...');
            }
        }

        // 上传到Supabase Storage
        async function uploadToStorage(blob) {
            if (!currentUser) return;

            try {
                const fileName = `${currentUser.id}/${Date.now()}.${isCameraOn ? 'webm' : 'webm'}`;
                const fileType = isCameraOn ? 'video' : 'audio';

                // 上传文件
                const { data, error } = await supabase
                    .storage
                    .from('recordings')
                    .upload(fileName, blob);

                if (error) {
                    console.error('上传失败:', error);
                    showMessage('recording-message', 'error', '上传失败，请重试');
                    return;
                }

                // 获取公网URL
                const { data: { publicUrl } } = supabase
                    .storage
                    .from('recordings')
                    .getPublicUrl(fileName);

                // 保存文件元数据到数据库
                const { error: dbError } = await supabase
                    .from('recording_files')
                    .insert({
                        user_id: currentUser.id,
                        file_url: publicUrl,
                        file_type: fileType,
                        duration: 0 // 暂时设置为0，实际应用中可以计算
                    });

                if (dbError) {
                    console.error('保存文件元数据失败:', dbError);
                    showMessage('recording-message', 'error', '保存文件元数据失败');
                    return;
                }

                showMessage('recording-message', 'success', '上传成功！文件已保存');
            } catch (error) {
                console.error('上传过程中发生错误:', error);
                showMessage('recording-message', 'error', '上传过程中发生错误');
            }
        }

        // 切换摄像头
        function toggleCamera() {
            isCameraOn = !isCameraOn;
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            initRecording();
        }

        // 显示消息
        function showMessage(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.className = `message ${type}`;
            element.textContent = message;
        }

        // 初始化添加联系人模态框
        function initAddContactModal() {
            const modal = document.getElementById('add-contact-modal');
            const addContactBtn = document.getElementById('add-contact-btn');
            const cancelBtn = document.getElementById('cancel-contact');
            const contactForm = document.getElementById('contact-form');

            addContactBtn.addEventListener('click', () => {
                modal.classList.add('active');
            });

            cancelBtn.addEventListener('click', () => {
                modal.classList.remove('active');
                contactForm.reset();
                document.getElementById('contact-message').innerHTML = '';
            });

            contactForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!currentUser) return;

                const name = document.getElementById('contact-name').value;
                const email = document.getElementById('contact-email').value;
                const phone = document.getElementById('contact-phone').value;

                const { data, error } = await supabase
                    .from('contacts')
                    .insert({
                        user_id: currentUser.id,
                        name,
                        email: email || null,
                        phone: phone || null
                    });

                if (error) {
                    console.error('添加联系人失败:', error);
                    showMessage('contact-message', 'error', '添加联系人失败，请重试');
                    return;
                }

                showMessage('contact-message', 'success', '联系人添加成功');
                modal.classList.remove('active');
                contactForm.reset();
                loadContacts();
            });
        }

        // 初始化遗物表单
        function initRelicForm() {
            const relicForm = document.getElementById('relic-form');
            const aiPolishBtn = document.getElementById('ai-polish');

            // AI润色功能
            aiPolishBtn.addEventListener('click', () => {
                const content = document.getElementById('relic-content').value;
                if (!content) {
                    showMessage('recording-message', 'error', '请先输入内容');
                    return;
                }

                // 模拟AI润色
                setTimeout(() => {
                    const polishedContent = content + '\n\n—— 时光留声 AI 润色';
                    document.getElementById('relic-content').value = polishedContent;
                    showMessage('recording-message', 'success', 'AI润色完成');
                }, 1000);
            });

            // 提交表单
            relicForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!currentUser) return;

                const contactId = document.getElementById('relic-contact').value;
                const title = document.getElementById('relic-title').value;
                const content = document.getElementById('relic-content').value;
                const silenceThreshold = parseInt(document.getElementById('silence-threshold').value);

                if (!contactId) {
                    showMessage('recording-message', 'error', '请选择联系人');
                    return;
                }

                const { data, error } = await supabase
                    .from('relics')
                    .insert({
                        user_id: currentUser.id,
                        contact_id: contactId,
                        title,
                        content,
                        ai_enhanced_content: content, // 暂时使用原始内容，实际应用中可以使用AI润色结果
                        silence_threshold_days: silenceThreshold
                    });

                if (error) {
                    console.error('创建遗物失败:', error);
                    showMessage('recording-message', 'error', '创建遗物失败，请重试');
                    return;
                }

                showMessage('recording-message', 'success', '遗物创建成功');
                relicForm.reset();
                loadRelics(contactId);
            });
        }

        // 初始化退出登录
        function initLogout() {
            document.getElementById('logout-btn').addEventListener('click', async () => {
                const { error } = await supabase.auth.signOut();
                if (error) {
                    console.error('退出登录失败:', error);
                } else {
                    window.location.href = 'index.html';
                }
            });
        }

        // 初始化应用
        function initApp() {
            checkUser();
            initAddContactModal();
            initRelicForm();
            initLogout();

            // 绑定录制按钮事件
            document.getElementById('start-record').addEventListener('click', startRecording);
            document.getElementById('stop-record').addEventListener('click', stopRecording);
            document.getElementById('toggle-camera').addEventListener('click', toggleCamera);
        }

        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>